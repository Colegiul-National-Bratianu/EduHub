<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Curs de Biologie - EduHub</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w.org/2000/svg' viewBox='0 0 48 48' fill='%230ea5e9'%3E%3Cpath d='M4 4H17.3334V17.3334H30.6666V30.6666H44V44H4V4Z'/%3E%3C/svg%3E" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
    
    <style>
      :root {
        --brand-primary: #0ea5e9;
        --brand-primary-hover: #0284c7;
        --background-dark: #0f172a;
        --background-panel: #1e293b;
        --text-light: #f1f5f9;
        --text-muted: #94a3b8;
        --border-color: #334155;
      }
      body {
        font-family: 'Work Sans', sans-serif;
        background-color: var(--background-dark);
        color: var(--text-light);
      }
      .sidebar-link {
        display: block;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        transition: background-color 0.2s, color 0.2s;
        color: var(--text-muted);
        font-weight: 500;
        border-left: 3px solid transparent;
      }
      .sidebar-link:hover {
        background-color: rgba(255, 255, 255, 0.05);
        color: var(--text-light);
      }
      .sidebar-link.active {
        background-color: rgba(14, 165, 233, 0.1);
        color: var(--brand-primary);
        font-weight: 600;
        border-left-color: var(--brand-primary);
      }
      /* Stiluri pentru componentele randate */
      .course-content h2 { @apply text-3xl font-bold text-white mt-8 mb-4 border-b border-border-color pb-2; }
      .course-content h3 { @apply text-2xl font-semibold text-sky-300 mt-6 mb-3; }
      .course-content p { @apply text-lg text-text-muted leading-relaxed mb-4; }
      .course-content img { @apply my-6 rounded-lg shadow-lg mx-auto; }
      .course-content ul { @apply list-disc list-inside space-y-2 mb-4 text-lg text-text-muted; }
      .course-content hr { @apply my-8 border-border-color; }
      
      .flip-card { 
        perspective: 1000px; 
        background-color: transparent;
        height: 250px;
        cursor: pointer;
      }
      .flip-card-inner {
        position: relative; width: 100%; height: 100%;
        transition: transform 0.6s; transform-style: preserve-3d;
      }
      .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
      .flip-card-front, .flip-card-back {
        position: absolute; width: 100%; height: 100%;
        -webkit-backface-visibility: hidden; backface-visibility: hidden;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        padding: 1.5rem; text-align: center;
        background-color: var(--background-panel);
        border: 1px solid var(--border-color);
        border-radius: 0.75rem;
      }
      .flip-card-back { transform: rotateY(180deg); }

      .reveal-card {
        background-color: var(--background-panel);
        border: 1px solid var(--border-color);
        border-radius: 0.75rem;
      }
      .reveal-card summary {
        padding: 1rem; cursor: pointer; font-weight: 600;
        color: var(--text-light);
        list-style-type: 'ðŸ‘‡ ';
      }
      .reveal-card[open] summary {
         list-style-type: 'ðŸ‘† ';
      }
      .reveal-card div {
        padding: 0 1rem 1rem 1rem;
        margin-top: 0.5rem;
        border-top: 1px solid var(--border-color);
      }

    </style>
</head>
<body class="antialiased">
    <div class="flex flex-col min-h-screen">
        <!-- Header Section -->
        <header class="bg-black/30 backdrop-blur-md sticky top-0 z-50 border-b border-white/10">
             <nav class="container mx-auto px-6 py-4 flex items-center justify-between">
                <a href="index.html" class="flex items-center gap-3">
                    <svg xmlns="http://www.w.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" class="h-8 w-8 text-[var(--brand-primary)]"><path fill="currentColor" d="M4 4H17.3334V17.3334H30.6666V30.6666H44V44H4V4Z"></path></svg>
                    <span class="text-2xl font-bold text-white">EduHub</span>
                </a>
                <a href="courses.html" class="text-base text-[var(--brand-primary)] font-semibold hover:underline">
                    &larr; ÃŽnapoi la Cursuri
                </a>
            </nav>
        </header>

        <div class="container mx-auto px-6 py-12 flex-grow">
            <div class="flex flex-col md:flex-row gap-8 lg:gap-12">
                <!-- Sidebar -->
                <aside id="course-sidebar" class="w-full md:w-1/4 lg:w-1/5 shrink-0">
                    <div class="sticky top-24">
                        <h2 id="course-title" class="text-xl font-bold text-white mb-4 px-1"></h2>
                        <nav id="subchapter-navigation" class="flex flex-col gap-1">
                            <!-- Subchapter links will be dynamically inserted here -->
                        </nav>
                    </div>
                </aside>

                <!-- Main Content -->
                <main id="course-content-wrapper" class="w-full md:w-3/4 lg:w-4/5">
                    <div id="course-content" class="course-content">
                        <!-- Content will be dynamically rendered here -->
                    </div>
                    <div id="loading" class="text-center py-16">
                        <svg class="animate-spin h-8 w-8 text-[var(--brand-primary)] mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    </div>
                </main>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="border-t border-white/10">
            <div class="container mx-auto px-6 py-8">
                 <div class="flex flex-col md:flex-row justify-between items-center text-center md:text-left gap-6">
                    <p class="text-[var(--text-muted)] text-sm">Â© 2024 EduHub. Toate drepturile rezervate.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const courseTitleEl = document.getElementById('course-title');
            const subchapterNavEl = document.getElementById('subchapter-navigation');
            const courseContentEl = document.getElementById('course-content');
            const loadingEl = document.getElementById('loading');
            
            let courseData = null;

            const getCourseIdFromUrl = () => {
                const params = new URLSearchParams(window.location.search);
                return params.get('id');
            };

            const findCourseData = (allCourses, courseId) => {
                for (const gradeKey in allCourses) {
                    const grade = allCourses[gradeKey];
                    const chapter = grade.capitole.find(c => c.id === courseId);
                    if (chapter) return chapter;
                }
                return null;
            };

            const renderComponent = (component) => {
                switch(component.type) {
                    case 'heading':
                        const level = component.level || 'h2';
                        return `<${level}>${component.content}</${level}>`;
                    case 'paragraph':
                        return `<p>${component.content}</p>`;
                    case 'image':
                        return `<img src="${component.src}" alt="${component.alt || 'Imagine curs'}" />`;
                    case 'list':
                        const items = component.items.map(item => `<li>${item}</li>`).join('');
                        return `<ul>${items}</ul>`;
                    case 'separator':
                        return `<hr />`;
                    case 'flip_card':
                        return `
                            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h3 class="text-xl font-semibold">${component.front}</h3>
                                        <p class="text-sm text-sky-400 mt-2">Click pentru a Ã®ntoarce</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <p>${component.back}</p>
                                    </div>
                                </div>
                            </div>`;
                    case 'reveal_card':
                        return `
                            <details class="reveal-card my-4">
                                <summary>${component.title}</summary>
                                <div><p>${component.content}</p></div>
                            </details>`;
                    default:
                        return `<p class="text-red-400">ComponentÄƒ necunoscutÄƒ: ${component.type}</p>`;
                }
            };

            const renderSubchapter = (subchapterId) => {
                if (!courseData) return;
                const subchapter = courseData.subcapitole.find(sc => sc.id === subchapterId);
                
                if (!subchapter) {
                    courseContentEl.innerHTML = `<h2 class="text-2xl text-red-400">Subcapitolul nu a fost gÄƒsit.</h2>`;
                    return;
                }
                
                // Update active link in sidebar
                subchapterNavEl.querySelector('.active')?.classList.remove('active');
                subchapterNavEl.querySelector(`[data-id="${subchapterId}"]`)?.classList.add('active');
                
                // Set page title
                document.title = `${subchapter.titlu} - EduHub`;

                // Render content
                let contentHTML = `<h2>${subchapter.titlu}</h2>`;
                if(subchapter.content && subchapter.content.length > 0) {
                    contentHTML += subchapter.content.map(renderComponent).join('');
                } else {
                    contentHTML += `<p class="text-center text-text-muted p-8 bg-background-panel rounded-lg">Acest subcapitol este Ã®n curs de dezvoltare. Revino Ã®n curÃ¢nd!</p>`;
                }
                courseContentEl.innerHTML = contentHTML;

                // Update URL hash
                window.location.hash = subchapterId;
            };

            const init = async () => {
                const courseId = getCourseIdFromUrl();
                if (!courseId) {
                    courseContentEl.innerHTML = `<h2>ID Curs Invalid</h2><p>Nu a fost specificat niciun curs. Te rugÄƒm sÄƒ te Ã®ntorci la <a href="courses.html" class="text-sky-400 underline">lista de cursuri</a>.</p>`;
                    loadingEl.style.display = 'none';
                    return;
                }

                try {
                    const response = await fetch('courses.json');
                    const allData = await response.json();
                    courseData = findCourseData(allData.biologie, courseId);
                    
                    if (!courseData) {
                        throw new Error("Cursul nu a fost gÄƒsit.");
                    }

                    courseTitleEl.textContent = courseData.titlu;
                    
                    subchapterNavEl.innerHTML = courseData.subcapitole.map(sc => 
                        `<a href="#${sc.id}" class="sidebar-link" data-id="${sc.id}">${sc.titlu}</a>`
                    ).join('');

                    subchapterNavEl.addEventListener('click', (e) => {
                        e.preventDefault();
                        const link = e.target.closest('.sidebar-link');
                        if (link) {
                            renderSubchapter(link.dataset.id);
                        }
                    });
                    
                    // Initial render
                    const initialSubchapterId = window.location.hash.substring(1) || courseData.subcapitole[0]?.id;
                    if(initialSubchapterId) {
                         renderSubchapter(initialSubchapterId);
                    } else {
                         courseContentEl.innerHTML = `<h2 class="text-2xl text-text-muted">Nu existÄƒ subcapitole pentru acest curs.</h2>`;
                    }
                   
                } catch (error) {
                    console.error("Eroare la Ã®ncÄƒrcarea cursului:", error);
                    courseContentEl.innerHTML = `<h2 class="text-2xl text-red-400">Eroare la Ã®ncÄƒrcare</h2><p>Nu am putut Ã®ncÄƒrca datele pentru acest curs. Te rugÄƒm sÄƒ Ã®ncerci din nou mai tÃ¢rziu.</p>`;
                } finally {
                    loadingEl.style.display = 'none';
                }
            };

            init();
        });
    </script>
</body>
</html>
